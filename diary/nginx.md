# nginx
é»˜è®¤é…ç½®æ–‡ä»¶defaultå†…å®¹å¦‚ä¸‹ï¼š

```
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
        }
    }
```


```
ğŸš€ Node + Nginx éƒ¨ç½²å¸¸è§é¢è¯•é—®ç­”é€Ÿè®°
ä¸€ã€åŸºç¡€æ¦‚å¿µ

Q: ä¸ºä»€ä¹ˆè¦ç”¨ Nginxï¼Ÿ
A: é™æ€èµ„æºæ€§èƒ½å¥½ã€æ”¯æŒåå‘ä»£ç†ã€èƒ½åšç¼“å­˜/è´Ÿè½½å‡è¡¡ã€å®‰å…¨æ§åˆ¶ã€‚

Q: æ­£å‘ä»£ç† vs åå‘ä»£ç†ï¼Ÿ
A: æ­£å‘ä»£ç†æ˜¯â€œå®¢æˆ·ç«¯æ‰¾ä»£ç†ä¸Šç½‘â€ï¼ˆVPN ä»£ç†ï¼‰ï¼›åå‘ä»£ç†æ˜¯â€œå®¢æˆ·ç«¯è®¿é—®ä»£ç†ï¼Œä»£ç†å†æ‰¾åç«¯â€ï¼ˆNginx å¸¸ç”¨ï¼‰ã€‚

Q: .env ä¸ºä»€ä¹ˆè¦ .gitignoreï¼Ÿ
A: é¿å…æ³„éœ² API Key ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ç”¨ .env.example åªä¿ç•™å˜é‡åï¼Œå¤§å®¶å„è‡ªå¡«å€¼ã€‚

äºŒã€å‰ç«¯éƒ¨ç½²ç›¸å…³

Q: ä¸ºä»€ä¹ˆè¦ try_files $uri $uri/ /index.html;ï¼Ÿ
A: è§£å†³å‰ç«¯å•é¡µåº”ç”¨ï¼ˆSPAï¼‰åˆ·æ–° 404ï¼Œæ²¡æ–‡ä»¶æ—¶å›é€€åˆ° index.html è®©å‰ç«¯è·¯ç”±æ¥ç®¡ã€‚

Q: proxy_pass å¸¦ä¸å¸¦æ–œæ çš„åŒºåˆ«ï¼Ÿ
A: ä¸å¸¦ /ï¼šåç«¯ä¿ç•™ /api/... å‰ç¼€ã€‚
å¸¦ /ï¼šä¼šå»æ‰ /api/ï¼Œåªè½¬å‘åé¢çš„è·¯å¾„ã€‚

ä¸‰ã€API / SSE

Q: SSE/æµå¼ä¸ºä»€ä¹ˆè¦ proxy_buffering off;ï¼Ÿ
A: é¿å… Nginx ç¼“å†²ï¼Œç¡®ä¿å®¢æˆ·ç«¯èƒ½å®æ—¶æ¥æ”¶æ¨é€ã€‚

Q: å¦‚ä½•åœ¨ä»£ç†æ—¶ä¿ç•™å®¢æˆ·ç«¯çœŸå® IPï¼Ÿ
A:

proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

å››ã€è¿›é˜¶é—®é¢˜

Q: Nginx å¦‚ä½•æ”¯æŒ WebSocketï¼Ÿ
A: éœ€è¦ï¼š

proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";


Q: Node æœåŠ¡æŒ‚äº† Nginx ä¼šæ€æ ·ï¼Ÿ
A: è¿”å› 502ã€‚å¯ä»¥é… upstream å¤šåç«¯åšè´Ÿè½½å‡è¡¡æˆ–åŠ å¥åº·æ£€æŸ¥ã€‚

Q: Nginx æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼Ÿ
A: worker_processes auto;ã€ç¼“å­˜é™æ€èµ„æºã€å¼€å¯ gzip/brotli å‹ç¼©ã€‚

ğŸ“Œ è®°å¿†æŠ€å·§ï¼š

å‰ç«¯ 404 â†’ try_filesã€‚

API è·¯å¾„å‰¥ç¦» â†’ proxy_pass æ–œæ ã€‚

å®æ—¶æµ â†’ å…³ç¼“å†²ã€‚

çœŸ IP â†’ X-Real-IPã€‚

WebSocket â†’ Upgrade + Connectionã€‚
```