name: Deploy VitePress to My Server

on:
  push:
    branches:
      - main  # æ¯æ¬¡æ¨é€ main åˆ†æ”¯å°±è§¦å‘éƒ¨ç½²

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: æ‹‰å–ä»£ç 
      uses: actions/checkout@v3

    - name: å®‰è£…ä¾èµ–
      run: npm ci

    - name: æ„å»º VitePress é¡¹ç›®
      run: npm run docs:build

    - name: ğŸ”¥ æ¸…ç©ºæœåŠ¡å™¨æ—§æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
      uses: appleboy/ssh-action@v0.1.7
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          rm -rf /home/html/gaga-blog/*

    - name: ä¸Šä¼  dist åˆ°ä½ çš„æœåŠ¡å™¨
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_KEY }}
        source: ".vitepress/dist/*"
        target: "/home/html/gaga-blog/"

    - name: å¯é€‰ï¼šé‡å¯ Nginxï¼ˆå¦‚æœä½ å¯ç”¨äº†ç¼“å­˜ï¼‰
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          sudo systemctl restart nginx
